<% if @input_error %>
  <%= render 'errors_modal' %>
<% end %>

<%= form_tag(updates_entry_indicators_path, method: 'post', name: 'entryIndicatorsForm', id: 'entryIndicatorsForm') do %>
  <div class="row">
    <% if @period.open_entry? %>
      <%= hidden_field_tag(:delete_justification)  if @no_changes_unit_staff %>
      <%= hidden_field_tag(:justification)  if @groups_exceeded %>
      <%= hidden_field_tag(:unit_id, @unit.id) %>
      <%= hidden_field_tag(:period_id, @period.id) %>
      <%= hidden_field_tag(:organization_id, @organization.id) %>
      <%= render 'buttons' %>
    <% else %>
        <div class="small-12 medium-4 columns">  </div>
    <% end %>
    <div class="columns medium-4 small-12">
      <%= render 'staff', of: 'Unit', process: @unit, unit: @unit, period: @period, type: 'all' %>
    </div>
  </div>
  <% @period.main_processes.order(:order).each do |main_process| %>
    <% if main_process.show_in_entry(@unit) %>
      <div class="main-process small-12 columns">
        <h5><%= main_process.order%>.&nbsp;<%= main_process.item.description %></h5>
      </div>
      <% main_process.sub_processes_unit(@unit).each do |sub_process| %>
        <table class="sub-process-tab" >
          <caption class="sub-process"><%= main_process.order%>.<%= sub_process.order%>.&nbsp;<%= sub_process.item.description %></caption>
          <thead>
            <tr>
              <th class="indicator-description"><strong><%= t("entry_indicators.form.indicator.#{process_name(@period, 'indicators')}") %> </strong></th>
              <% official_groups.each do |gr| %>
                  <th class="text-center"><%= gr.name %></th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% sub_process.indicators.each do |indicator| %>
              <tr id="indicator-row">
                <td class="indicator-description" id="<%= "indicator_col_#{indicator.id}" %>">
                  <% if indicator.description.nil? %>
                      <strong> <%= indicator.order %>. <%= indicator.item.description %></strong>
                  <% else %>
                      <br>
                      <div class="moderation-description">
                        <%= simple_format (indicator.description) %>
                      </div>
                  <% end %>
                </td>
                <%= render 'staff_indicator', process: indicator, unit: @unit, period: @period, type: 'data' %>
              </tr>
              <tr>
                <td colspan="6">
                  <%= render 'table_indicator_metric', indicator: indicator, period: @period %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <div class="columns medium-offset-8 medium-4 small-12">
            <%= render 'staff', of: 'SubProcess', process: sub_process, unit: @unit, period: @period, type: 'all'   %>
        </div>
      <% end %>

    <% end %>
  <% end %>

  <% if @period.open_entry? %>
    <%= render 'buttons' %>
   <% end %>

<% end %>
